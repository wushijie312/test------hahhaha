function array_contain(t,a){for(var r=0;r<t.length;r++)if(t[r]==a)return!0;return!1}function InitCart(t,a,r,e,i,n){_apiHead=t,_userid=a,_username=r,_parentControl=e,_productClick=n,_imgurl=i,getShoppingCar(t,a,r,e,i,callBack,n)}function reloadCart(){getShoppingCar(_apiHead,_userid,_username,_parentControl,_imgurl,callBack,_productClick)}function callBack(){$(".dropdown").mouseenter(function(){$(this).css("border","solid 1px #00a0e6").addClass("cart-hover"),$(".cart").css("background","#fff"),$(".dropdown-layer").css({border:"solid 1px #00a0e6",display:"block"}).addClass("cart-hover")}).mouseleave(function(){$(this).css("border","").removeClass("cart-hover"),$(".cart").css("background","#f9f9f9"),$(".dropdown-layer").css({border:"",display:"none"}).removeClass("cart-hover")}),$(".smc li").mouseenter(function(){$(this).css("background","#f5f5f5")}).mouseleave(function(){$(this).css("background","#fff")})}function getShoppingCar(t,a,r,e,i,n,c){var o={FType:67,UserID:a,CustomerName:r};$.ajax({type:"Get",url:t+"/api/ShoppingCart/?"+Math.random(),data:o,dataType:"jsonp",success:function(a,i){var o=$.parseJSON(a);if(null!=o&&null!=o){var s='<div class="WrapCart clearfix">';s+='<div class="dropdown Fright">',s+='<div class="cart" >',s+=""==r?'<i class="ca-left"></i><i class="ca-right">></i> <i class="ca-count">0</i> <a href="javascript:void(0)">我的购物车</a>':'<i class="ca-left"></i><i class="ca-right">></i> <i class="ca-count">0</i> <a href="'+t+'/BigCustomer/Cart">我的购物车</a>',s+="</div>",s+='<div class="dropdown-layer">',s+='<div class="spacer"></div>',s+='<div class="settleup-content">',s+='<div class="prompt">',s+='<div class="nogoods"><b></b>购物车中还没有商品，赶紧选购吧</div>',s+="</div></div></div></div></div>",e.html(s),null!=c&&c();var d="";if(o.length>0){var l=0,u=0,p=0;$.each(o,function(a,e){l=0,p=e.TenantId;var i=0==e.ProductEnable,n=i?"":"item-opacity";e.ProductImg=null==e.ProductPic_Biny||""==e.ProductPic_Biny?e.ProductImg:e.ProductPic_Biny,0==a&&(d+='<div class="smt">',d+="<h4>最新加入的商品</h4>",d+="</div>",d+='<div class="smc">',d+='<ul id="mcart-sigle">'),isNaN(parseFloat(e.ProductPrice))||987123==parseFloat(e.ProductPrice)||(l=parseFloat(e.ProductSubtotal)),d+='<li class="clearfix'+(1==e.IsReOrder?" reorder":2==e.IsReOrder?" againorder":"")+'">',d+='<div class="p-img Fleft">',d+=' <a href="'+(i?e.ProductUrl:"javascript:void(0)")+'" class="'+n+'"><img src="'+e.ProductImg+'" /></a>',d+="</div>",d+='<div class="p-name Fleft">',array_contain(jifentenantIds,p)&&(e.ProductCon=""),d+='<a href="'+(i?e.ProductUrl:"javascript:void(0)")+'" class="'+n+'" title="'+(null==e.ProductName?"":e.ProductName)+e.ProductCon+'" >'+(null==e.ProductName?"":e.ProductName)+"</a>",d+='<p class="p-infor">'+e.ProductCon+"</p>",d+="</div>",d+='<div class="p-detail Fright">',array_contain(hidepricetenantIds,p)||(d+='<span class="p-price '+n+'"> <strong>'+(""==e.ProductPrice||null==e.ProductPrice?"暂无报价":987123==parseFloat(e.ProductPrice)?"价格待议":(array_contain(jifentenantIds,p)?"":"￥")+parseFloat(parseFloat(e.ProductUnitPrice).toFixed(3)))+(array_contain(jifentenantIds,p)?"积分":"")+"</strong>"),d+="x"+e.Quantity,d+="</span></br> ",2!=e.ProductEnable&&(d+='<a class="delete" href="javascript:void(0);" price="'+l+'" onclick="dProduct(\''+e.ProductCode+"',this,'"+r+"','"+t+"')\">删除</a>"),d+="</div>",i||(d+='<div style="position: absolute; left: 2px; top: 10px; z-index: 99;"><img src="',1==e.ProductEnable?d+="https://static.98ep.com/Img/BCustomer/subfileImg/xiajia.png":d+="https://static.98ep.com/Img/BCustomer/subfileImg/tijiao.png",d+='" width="70"></div>'),d+="</li>",u+=l,a==o.length-1&&(d+="</ul>",d+='<ul id="mcart-gift"></ul>',d+='<ul id="mcart-mz"></ul>',d+="</div>")}),d+='<div class="smb clearfix">',d+='<div class="p-total Fleft">',d+="共<strong>"+o.length+"</strong>种商品",array_contain(hidepricetenantIds,p)||(d+="，共计<strong>"+(array_contain(jifentenantIds,p)?"":"￥")+'<span id="span_totalprice">'+parseFloat(u.toFixed(2))+"</span>"+(array_contain(jifentenantIds,p)?"积分":"")+"</strong>"),d+="</div>",d+='<a href="https://passport.yangguangqicai.com/Home/GotoUrl?bakurl='+escape(t+"/BigCustomer/Cart")+'" title="去购物车"><span>去购物车</span></a>',$("i.ca-count").text(o.length),$("div.settleup-content").html(d)}null!=n&&n(),"undefined"!=typeof rewriteURL&&rewriteURL instanceof Function&&rewriteURL()}},error:function(t,a,r){}})}function isExitsFunction(funcName){try{if("function"==typeof eval(funcName))return!0}catch(t){}return!1}function dProduct(t,a,r,e){var i=new Array;i.push(t);var n={FType:71,CustomerName:r,ProductCodes:i};$.ajax({type:"Get",url:e+"/api/ShoppingCart/?"+Math.random(),data:n,dataType:"jsonp",success:function(t,r){if(parseInt(t)>0){var e=$(a).parents("li:eq(0)"),i=parseFloat($(a).attr("price")),n=parseFloat($("#span_totalprice").text())-i;if(1==$(a).parents("ul").find("li").length)clearCart();else{e.remove();var c=parseInt($("i.ca-count").text())-1;$("i.ca-count").text(c),$("#cartProductCount").text(c),$("#span_totalprice").text(n.toFixed(tofixedlength))}}},error:function(t,a,r){}})}function clearCart(){var t='<div class="prompt">';t+='<div class="nogoods">',t+='<b></b>"购物车中还没有商品，赶紧选购吧"',t+="</div>",t+="</div>";var a=parseInt($("i.ca-count").text())-1;$("i.ca-count").text(a),$("#cartProductCount").text(a),$("div.settleup-content").html(t),$(".dropdown").mouseout()}var _apiHead,_userid,_username,_parentControl,_productClick,_imgurl,tofixedlength=2,jifentenantIds=[595],hidepricetenantIds=[498];